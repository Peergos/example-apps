function W(e,t,n,r){let l=n.length,s=/[:,@]\S*=/.exec(e);if(!s)return console.error("MiNi: attribute is missing :@ prefix",e),!1;if(s?.length>1)return console.error('MiNi: attribute is missing "${}"',e),!1;if(!e.endsWith(s[0]+'"'))return console.error("MiNi: attribute "+s[0]+' is missing "${}"'),!1;const a=s[0][0],o=s[0].slice(1,-1);n.push({type:a,key:o,v:t});const i=e.lastIndexOf(o);return e=e.substring(0,i-1)+e.substring(i-1).replace(a+o,o+l),e.slice(-1)==='"'?r.push(""):r.push('""'),e}function B(e,...t){let n=[...e];function r(l){let s=[],a=[],o=!1;for(let u=0;u<t.length;u++){const c=t[u],b=n[u],d=b.lastIndexOf("<"),k=b.lastIndexOf(">");o=d!==-1&&d>k?!0:o,o=k!==-1&&k>d?!1:o;const w=a.length;if(typeof c=="function"||c instanceof Promise||c?.signal)if(!o)a.push({type:"node",key:w,v:c}),s[u]=`<!--rx${w}-->`;else{const m=W(n[u],c,a,s);m?n[u]=m:console.error("MiNi: unknown attribute type",n[u],c)}else Array.isArray(c)?(s[u]="",c.forEach((m,I)=>{typeof m=="function"?(a.push({type:"node",key:w+":"+I,v:m}),s[u]+=`<!--rx${w}:${I}-->`):s[u]+=m})):c===!1||c===void 0?(o&&n[u].slice(-1)==='"'&&(n[u]=n[u].replace(/\s(\S+)$/,'"')),s.push("")):s.push(c)}function i(u,c){let b=u[0];for(let d=0;d<c.length;d++)b+=c[d]+u[d+1];return b.replace(/\s+/g," ")}let p=i(n,s);return p=p.replace(/(?=\/\*).*?(?:\*\/)/g,""),{html:p.trim(),reactarray:a}}return r.html=!0,r}let g,h=null,f=0,N=[],O,_=!1;const M=0,j=1,v=2;function E(e,t){const n=new H(e,t?.effect,t?.label);return t?.equals&&(n.equals=t.equals),n.signal=!0,n}function D(e,t){return e===t}class H{_value;fn;observers=null;sources=null;state;effect;label;cleanups=[];equals=D;constructor(t,n,r){typeof t=="function"?(this.fn=t,this._value=void 0,this.effect=n||!1,this.state=v,n&&(N.push(this),O?.(this))):(this.fn=void 0,this._value=t,this.state=M,this.effect=!1),r&&(this.label=r)}get value(){return this.get()}set value(t){this.set(t)}get(){return g&&(!h&&g.sources&&g.sources[f]==this?f++:h?h.push(this):h=[this]),this.fn&&this.updateIfNecessary(),this._value}set(t){if(typeof t=="function"){const n=t;n!==this.fn&&this.stale(v),this.fn=n}else{this.fn&&(this.removeParentObservers(0),this.sources=null,this.fn=void 0);const n=t;if(!this.equals(this._value,n)){if(this.observers)for(let r=0;r<this.observers.length;r++)this.observers[r].stale(v);this._value=n}}}stale(t){if(this.state<t&&(this.state===M&&this.effect&&(N.push(this),O?.(this)),this.state=t,this.observers))for(let n=0;n<this.observers.length;n++)this.observers[n].stale(j)}update(){const t=this._value,n=g,r=h,l=f;g=this,h=null,f=0;try{if(this.cleanups.length&&(this.cleanups.forEach(s=>s(this._value)),this.cleanups=[]),this._value=this.fn(),h){if(this.removeParentObservers(f),this.sources&&f>0){this.sources.length=f+h.length;for(let s=0;s<h.length;s++)this.sources[f+s]=h[s]}else this.sources=h;for(let s=f;s<this.sources.length;s++){const a=this.sources[s];a.observers?a.observers.push(this):a.observers=[this]}}else this.sources&&f<this.sources.length&&(this.removeParentObservers(f),this.sources.length=f)}finally{h=r,g=n,f=l}if(!this.equals(t,this._value)&&this.observers)for(let s=0;s<this.observers.length;s++){const a=this.observers[s];a.state=v}this.state=M}updateIfNecessary(){if(this.state===j){for(const t of this.sources)if(t.updateIfNecessary(),this.state===v)break}this.state===v&&this.update(),this.state=M}removeParentObservers(t){if(this.sources)for(let n=t;n<this.sources.length;n++){const r=this.sources[n],l=r.observers.findIndex(s=>s===this);r.observers[l]=r.observers[r.observers.length-1],r.observers.pop()}}}function T(e){const t=g,n=h,r=f;g=void 0,h=null,f=0;const l=e();return h=n,g=t,f=r,l}function J(){for(let e=0;e<N.length;e++)N[e].get();N.length=0}function K(e=R){O=e}K();function R(){_||(_=!0,queueMicrotask(()=>{_=!1,J()}))}function C(e){if(e.nodeType){let t=[e];return t.parent=e.parentNode,t.next=e.nextSibling,t.prev=e.previousSibling,t.fragment=!0,t}else return Array.isArray(e)&&!e.fragment?e[0]?(e[0].before(document.createTextNode("")),e[e.length-1].after(document.createTextNode("")),e.parent=e[0].parentNode,e.prev=e[0].previousSibling,e.next=e[e.length-1].nextSibling,e.fragment=!0,e):!1:(console.error("MiNi: unknown input for createFragment"),!1)}function U(e,t){return e.fragment&&Array.isArray(e)&&Array.isArray(t)?(t.prev=e.prev,t.next=e.next,t.parent=e.parent,S(e),t.next?t.next.before(...t):t.parent.append(...t),t.fragment=!0):console.error("MiNi: replaceFragments unknown input",e,t),t}function S(e){if(!e.prev&&!e.next&&e.parent)e.parent.textContent="";else{if(e.prev?.nextSibling===e.next)return e;{let t=e.prev?.nextSibling||e.next?.parentElement?.firstChild||e.parent?.firstChild;if(!t)return;for(;t!==e.next;){if(!t)return console.error("MiNi: clearFragment missing node",e);const n=t.nextSibling;t.remove(),t=n}}}return e.length&&e.splice(0,e.length),e}let y=[];function ee(e){y.push(e)}let x=[];function te(e){x.push(e)}function P(e,t=[]){return e.unmount&&(t.push(e.unmount),delete e.unmount),Object.getOwnPropertySymbols(e).forEach(n=>{e[n]?.frag&&P(e[n],t)}),t.flat().reverse()}function V(e,t){const n=document.createComment("rx");let r=new Array(e.length);r=r.fill(0).map(()=>n.cloneNode()),t.frag=U(t.frag,r);for(let l=0;l<e.length;l++)L(r[l],()=>e[l],t)}function X(e,t){if(t)if(t.hidden&&(t.hidden=!1),e?.html)q(t.frag,e,t),t.mount&&setTimeout(()=>{t.mount?.forEach(n=>n()),t.mount=void 0},0);else if(Array.isArray(e))V(e,t),t.mount&&setTimeout(()=>{t.mount?.forEach(n=>n()),t.mount=void 0},0);else if(e===!1||e==="")S(t.frag),t.hidden=!0;else{let n=t.frag.prev.nextSibling;if(n.nodeType!==3){const r=document.createTextNode("");n.replaceWith(r),n=r}e!==void 0&&n.data!==e&&(n.data=e)}}function Y(e){const t=Object.getOwnPropertySymbols(e).filter(r=>e[r]?.loader)?.[0];if(!t)return;const n=e[t].frag;S(n),delete e[t]}function $(e){Object.getOwnPropertySymbols(e).forEach(t=>{e[t]?.frag&&(e[t].stale=!0,$(e[t]),delete e[t])})}function L(e,t,n){const r=Symbol("$comp");if(n[r]={},e.before(document.createTextNode("")),e.after(document.createTextNode("")),n[r].frag=C(e),t._map)return t(n,r);E(async()=>{if(!n[r])return;if(n.stale||n[r].stale)return delete n[r];const l=y.length,s=x.length,a=P(n[r]);a.length&&a.forEach(i=>typeof i=="function"&&i()),$(n[r]);let o=t();if(o instanceof Promise&&(o=await o),!!n[r]){if(y.length>l){const i=y.length-l;n[r].mount=y.splice(-i,i)}if(x.length>s){const i=x.length-s;n[r].unmount=x.splice(-i,i)}if(typeof o=="function"&&o?._map)return o(n,r);if(t._loader&&(n[r].loader=!0),t._suspense){if(!n[r])return;n[r].suspense=!0,Y(n),delete t._suspense}o=typeof o=="function"&&!o?.html?T(o):o,X(o,n[r])}},{effect:!0})}function Z(e,t,n,r){function l(o,i,p){p===!0?o.setAttribute(i,i):p===!1?o.removeAttribute(i):p!==!1&&p!=null&&o.setAttribute(i,p)}const s=Symbol("$attr");r[s]={},r[s].frag=C(e);const a=E(n);E(()=>{if(!r[s])return;if(r.stale||r[s].stale)return delete r[s];let o=a.value;t==="value"?o.signal?e.value=o.value:e.value=o:t==="ref"?(e.removeAttribute(t),n.signal&&(n.value=e)):l(e,t,o)},{effect:!0})}function z(e,t){return document.createTreeWalker(e,128,{acceptNode:n=>n.textContent===t?1:2}).nextNode()}function q(e,t,n={0:{}}){if(!e)return console.error("MiNi: renderClient missing node element");if(e.nodeType&&(e=C(e)),typeof t=="function"&&!t.html&&(t=T(t)),typeof t=="function"&&t.html&&(t=T(t)),t.html===void 0)return console.error("MiNi: unknown input to renderClient",t);const{html:r,reactarray:l}=t,s=document.createElement("template");s.innerHTML=r;const a=e.prev?.parentNode||e.parent;for(let o=0;o<l.length;o++){let i,{type:p,key:u,v:c}=l[o];switch(p){case"node":i=z(s.content,"rx"+u),i?typeof c=="function"?L(i,c,n):c instanceof Promise?console.error("MiNi: wrap async component in ()=>{}"):c.html===!0?i=q(i,c,n):console.error("MiNi: unknown node value",c):console.error("MiNi: cannot find placeholder","rx"+u,a);break;case"@":case":":i=s.content.querySelector(`[${u+o}]`),i?(i.removeAttribute(u+o),p===":"?Z(i,u,c,n):p==="@"?i.addEventListener(u.toLowerCase(),c,u==="onwheel"?{passive:!1}:{}):console.error("MiNi: unknown special attr",p,o)):console.error("MiNi: cannot find attribute",u+o);break}}return S(e),e.next?e.next.before(s.content):a?.appendChild(s.content),e.destroy=()=>{const o=P(n);o.length&&o.forEach(i=>typeof i=="function"&&i()),$(n),S(e)},e}async function ne(e,t,n){if(e.appendChild(document.createElement("div")),typeof t!="function")return console.error("MiNi: render 2nd arg must be a function");let r={0:{}};try{const l=await q(e.children[0],B`${()=>t()}`,r);return n&&console.log("rootowner",r),l}catch(l){console.error("MiNi: render",l)}}const G={};let A;function re(...e){let t;if(!A){const n=window._ctx_||{url:window.location.pathname};A=Q(r=>({...G,...n}))}if(t=A,!e||!e.length)return t.getState();if(e.length===1){if(typeof e[0]=="string")return t.getState()[e[0]];if(typeof e[0]=="object")return t.setState(e[0]);console.error("MiNi: unknown store argument")}else if(e.length===2){if(typeof e[0]!="string")return console.error("MiNi: unknown store argument");if(typeof e[1]=="function"){const n=t.getState()[e[0]];e[1]=e[1](n)}return t.setState({[e[0]]:e[1]})}else console.error("MiNi: store has too many arguments")}const F=e=>{let t;const n=(a,o)=>{const i=typeof a=="function"?a(t):a;Object.is(i,t)||(t=o??(typeof i!="object"||i===null)?i:Object.assign({},t,i))},r=()=>t,l={setState:n,getState:r,getInitialState:()=>s},s=t=e(n,r,l);return l},Q=e=>e?F(e):F;export{B as J,E as P,ne as f,te as o,ee as u,re as y};
